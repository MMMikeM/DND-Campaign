---
import Icon from "@components/Icon.astro";

interface Props {
  entityId: number | string;
  entityType: 'faction' | 'npc' | 'quest' | 'location';
  buttonText?: string;
  confirmMessage?: string;
  redirectPath?: string;
  className?: string;
}

const { 
  entityId, 
  entityType, 
  buttonText = "Delete", 
  confirmMessage = `Are you sure you want to delete this ${entityType}? This action cannot be undone.`,
  redirectPath,
  className = "bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 flex items-center"
} = Astro.props;
---

<button
  type="button"
  data-entity-id={entityId}
  data-entity-type={entityType}
  data-confirm-message={confirmMessage}
  data-redirect-path={redirectPath || `/${entityType}s`}
  class={`delete-entity ${className}`}
>
  <Icon name="trash" class="mr-2" size="sm" />
  {buttonText}
</button>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const deleteButtons = document.querySelectorAll('.delete-entity');
  
  deleteButtons.forEach(button => {
    button.addEventListener('click', async () => {
      const entityId = button.getAttribute('data-entity-id');
      const entityType = button.getAttribute('data-entity-type');
      const confirmMessage = button.getAttribute('data-confirm-message') || 'Are you sure you want to delete this item?';
      const redirectPath = button.getAttribute('data-redirect-path') || '/';
      
      if (!entityId || !entityType) return;
      
      if (confirm(confirmMessage)) {
        try {
          const response = await fetch(`/api/${entityType}s/${entityId}`, {
            method: 'DELETE',
          });
          
          if (response.ok) {
            window.location.href = redirectPath;
          } else {
            const error = await response.json();
            alert(`Error: ${error.message || `Failed to delete ${entityType}`}`);
          }
        } catch (error) {
          console.error(`Error deleting ${entityType}:`, error);
          alert(`An error occurred while trying to delete the ${entityType}. Please try again.`);
        }
      }
    });
  });
});
</script> 