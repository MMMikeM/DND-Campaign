import { db } from '../../lib/db';
import { npcs } from '@tome-keeper/shared';
import { desc } from 'drizzle-orm';

export const prerender = false;

const allNpcs = await db.select().from(npcs).orderBy(desc(npcs.id));

<Layout title="NPCs">
  <div class="mb-6 flex justify-between items-center">
    <h1 class="text-3xl font-bold text-white">NPCs</h1>
    <a href="/npcs/new" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
      </svg>
      New NPC
    </a>
  </div>

  <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
    {allNpcs.map(npc => (
      <a href={`/npcs/${npc.id}`} class="bg-slate-800 rounded-lg overflow-hidden shadow-lg border border-slate-700 hover:border-blue-500 hover:shadow-blue-900/30 transition-all duration-200">
        <div class="p-5">
          <h2 class="text-xl font-semibold text-white mb-2">{npc.name}</h2>
          <div class="flex flex-wrap gap-2 mb-3">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-900 text-blue-200">
              {npc.race}
            </span>
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-900 text-purple-200">
              {npc.occupation}
            </span>
          </div>
          <p class="text-slate-400 line-clamp-3">{npc.background}</p>
          
          <div class="mt-4 pt-4 border-t border-slate-700 flex justify-between items-center">
            <div class="flex items-center text-slate-400 text-sm">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
              </svg>
              {npc.role || npc.occupation}
            </div>
            <span class="text-blue-400 text-sm font-medium hover:text-blue-300">View Details â†’</span>
          </div>
        </div>
      </a>
    ))}
  </div>

  {allNpcs.length === 0 && (
    <div class="text-center p-10 bg-slate-800 rounded-lg border border-slate-700">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-slate-600 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
      </svg>
      <h3 class="text-xl font-medium text-slate-300 mb-2">No NPCs Found</h3>
      <p class="text-slate-400 mb-4">You haven't created any NPCs yet.</p>
      <a href="/npcs/new" class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
        </svg>
        Create Your First NPC
      </a>
    </div>
  )}
</Layout> 